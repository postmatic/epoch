Handlebars.registerHelper("epochLink",function(d,b,a,c,f,e){b=b.replace(/-comment_date-/g,this.comment_date);b in epoch_translation&&(b=epoch_translation[b]);a in epoch_translation&&(a=epoch_translation[a]);b=new Handlebars.SafeString(b);d=!d||/^\s*$/.test(d)?"#":Handlebars.Utils.escapeExpression(d);a=Handlebars.Utils.escapeExpression(a);d='<a href="'+d+'" title="'+a+'"';e&&!/^\s*$/.test(e)&&(e=Handlebars.Utils.escapeExpression(e),d+=' rel="'+e+'"');"string"==typeof f&&f&&!/^\s*$/.test(f)&&(f=Handlebars.Utils.escapeExpression(f),
d+=' target="'+f+'"');"string"==typeof c&&c&&!/^\s*$/.test(c)&&(c=Handlebars.Utils.escapeExpression(c),d+=' class="'+c+'"');return new Handlebars.SafeString(d+(" >"+b+"</a>"))});Handlebars.registerHelper("epochTranslation",function(d){string="";d in epoch_translation&&(string=epoch_translation[d]);return new Handlebars.SafeString(string)});
jQuery(document).ready(function(d){(function(b,a){a.init=function(){a.form_wrap_el=document.getElementById(epoch_vars.form_wrap);a.comments_wrap_el=document.getElementById(epoch_vars.comments_wrap);a.template_el=document.getElementById(epoch_vars.comments_template_id);a.count_el=document.getElementById(epoch_vars.count_id);a.last_count=0;a.highest_id=0;a.no_comments=!1;a.comments_close=!1;a.shut_it_off=!1;a.max_depth=parseInt(epoch_vars.depth);a.form_el=document.getElementById(epoch_vars.form_id);
null!=a.form_el&&(a.form_el.removeAttribute("action"),a.form_el.setAttribute("action","post"));a.set_width();a.comments_open();a.comment_count(!1);window.onresize=function(b){a.set_width()};epoch_vars.live_mode&&Visibility.every(epoch_vars.epoch_options.interval,function(){0==a.shut_it_off&&a.comment_count(!0)});b(document).on("submit","#"+epoch_vars.form_id,function(c){c.preventDefault();a.shut_it_off=!0;var f=!1,d=[];b(a.form_el).find("select, textarea, input").each(function(){b(this).prop("required")&&
!b(this).val()&&(f=!0,d.push(b(this).attr("id")))});f?(b(".epoch-failure").removeClass("epoch-failure"),0<d.length&&b.each(d,function(a,c){c=document.getElementById(c);null!==c&&b(c).parent().addClass("epoch-failure")})):(b(".epoch-failure").removeClass("epoch-failure"),b(a.form_el).find('input[type="submit"]').attr("disabled","disabled"),data=b(this).serializeArray(),b.post(epoch_vars.submit_api_url,data).complete(function(){b(a.form_el).find('input[type="submit"]').removeAttr("disabled")}).success(function(c){if(!c.success)return alert(epoch_translation.comment_rejected),
!1;b("textarea#comment").val("");b("#comment_parent").val("0");temp_el=document.getElementById("wp-temp-form-div");null!=temp_el&&(respond_el=document.getElementById("respond"),b(respond_el).insertAfter(temp_el));a.set_last_count(a.last_count+1);c=a.get_data_from_response(c);comment=c.comment;id=parseInt(comment.comment_ID,10);a.highest_id<id&&(a.highest_id=id);null==document.getElementById("comment-"+comment.comment_ID)&&(html=a.parse_comment(comment),a.put_comment_in_dom(html,comment.comment_parent,
comment.depth,id),comment_el=document.getElementById("comment-"+comment.comment_ID),null!=comment_el&&b(comment_el).addClass("epoch-success").delay(100).queue(function(a){b(this).removeClass("epoch-success");a()}));jQuery("body").triggerHandler("epoch.comment.posted",[comment.comment_post_ID,comment.comment_ID]);a.shut_it_off=!1}).fail(function(c){c.responseJSON&&c.responseJSON.data&&c.responseJSON.data.message&&alert(b("<div/>").html(c.responseJSON.data.message).text());b(a.form_wrap_el,"textarea#comment").addClass("epoch-failure").delay(100).queue(function(a){b(this).removeClass("epoch-failure");
a()})}))})};a.comments_open=function(){a.shut_it_off=!0;b.post(epoch_vars.api_url,{action:"comments_open",epochNonce:epoch_vars.nonce,postID:epoch_vars.post_id}).fail(function(c){a.shut_it_off=!1}).success(function(c){c=a.get_data_from_response(c);1==c?a.shut_it_off=!1:a.comments_closed=!0})};a.comment_count=function(c){a.shut_it_off=!0;b.post(epoch_vars.api_url,{action:"comment_count",epochNonce:epoch_vars.nonce,postID:epoch_vars.post_id}).fail(function(c){a.shut_it_off=!1}).success(function(b){b=
a.get_data_from_response(b);"undefined"!=b.count&&0<b.count?(c?b.count>a.last_count&&a.new_comments():a.get_comments(),a.set_last_count(b.count)):a.no_comments=!0;a.shut_it_off=!1})};a.get_comments=function(){a.shut_it_off=!0;b.post(epoch_vars.api_url,{action:"get_comments",epochNonce:epoch_vars.nonce,postID:epoch_vars.post_id,highest:0}).done(function(c){a.shut_it_off=!1}).success(function(c){c=a.get_data_from_response(c);a.comment_response(c,!1);jQuery("body").triggerHandler("epoch.comments.loaded")})};
a.comment_response=function(c,d){if("object"==typeof c&&"undefined"!=c&&"undefined"!=c.comments&&(comments=c.comments,comments=JSON.parse(comments),"undefined"!==comments&&0<comments.length)){var e=[],g=[];b.each(comments,function(c,b){id=parseInt(b.comment_ID,10);a.highest_id<id&&(a.highest_id=id);0==b.comment_parent?e.push(b):g.push(b)});"ASC"==epoch_vars.epoch_options.order?(g.reverse(),e.reverse()):g.reverse();b.each(e,function(c,e){html=a.parse_comment(e);a.put_comment_in_dom(html,e.comment_parent,
e.depth,parseInt(e.comment_ID,10));d&&(comment_el=document.getElementById("comment-"+e.comment_ID),null!=comment_el&&b(comment_el).addClass("epoch-success").delay(100).queue(function(a){b(this).removeClass("epoch-success");a()}))});b.each(g,function(c,b){html=a.parse_comment(b);a.put_comment_in_dom(html,b.comment_parent,b.depth,parseInt(b.comment_ID,10))})}};a.new_comments=function(){a.shut_it_off=!0;b.post(epoch_vars.api_url,{action:"new_comments",epochNonce:epoch_vars.nonce,postID:epoch_vars.post_id,
highest:a.highest_id}).done(function(b){a.shut_it_off=!1}).success(function(b){b=a.get_data_from_response(b);a.comment_response(b,!0)})};a.get_data_from_response=function(a){return a.data};a.parse_comment=function(c){parent_id=c.comment_parent;source=b(a.template_el).html();template=Handlebars.compile(source);return html=template(c)};a.put_comment_in_dom=function(c,d,e,g){e>a.max_depth&&(alert(),e=a.max_depth);0==d&&"DESC"==epoch_vars.epoch_options.order?(first_child=a.comments_wrap_el.firstChild,
new_el=document.createElement("div"),new_el.innerHTML=c,a.comments_wrap_el.insertBefore(new_el,first_child)):0==d?b(c).appendTo(a.comments_wrap_el):(c='<div class="epoch-child child-of-'+d+" level-"+e+' ">'+c+"</div>",parent_el=document.getElementById("comment-"+d),null!=parent_el?b(c).appendTo(parent_el):b(c).appendTo(a.comments_wrap_el));b(".comment-reply-link").click(function(a){a.preventDefault()})};a.set_width=function(){el=document.getElementById(epoch_vars.sniffer);null!=el&&(content_width=
b(el).parent().outerWidth(),"number"==typeof content_width&&(wrap_el=document.getElementById(epoch_vars.wrap_id),b(wrap_el).css("width",content_width)))};a.set_last_count=function(c){a.last_count=c;b(a.count_el).text(c)}})(jQuery,window.Epoch||(window.Epoch={}))});jQuery(function(){Epoch.init()});