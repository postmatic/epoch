Handlebars.registerHelper("epochLink",function(a,b,c,d,e,f){b=b.replace(/-comment_date-/g,this.comment_date),b in epoch_translation&&(b=epoch_translation[b]),c in epoch_translation&&(c=epoch_translation[c]),b=new Handlebars.SafeString(b),a=!a||/^\s*$/.test(a)?"#":Handlebars.Utils.escapeExpression(a),c=Handlebars.Utils.escapeExpression(c);var g='<a href="'+a+'" title="'+c+'"';return!f||/^\s*$/.test(f)||(f=Handlebars.Utils.escapeExpression(f),g+=' rel="'+f+'"'),"string"!=typeof e||!e||/^\s*$/.test(e)||(e=Handlebars.Utils.escapeExpression(e),g+=' target="'+e+'"'),"string"!=typeof d||!d||/^\s*$/.test(d)||(d=Handlebars.Utils.escapeExpression(d),g+=' class="'+d+'"'),g+=" >"+b+"</a>",new Handlebars.SafeString(g)}),Handlebars.registerHelper("epochTranslation",function(a){return string="",a in epoch_translation&&(string=epoch_translation[a]),new Handlebars.SafeString(string)}),jQuery(document).ready(function(a){!function(a,b){b.init=function(){b.find_elements(),b.last_count=0,b.highest_id=0,b.no_comments=!1,b.comments_close=!1,b.shut_it_off=!1,b.max_depth=parseInt(epoch_vars.depth),b.parent_ID=0,null!=b.form_el&&(b.form_el.removeAttribute("action"),b.form_el.setAttribute("action","post")),b.set_width(),b.comments_open(),b.initial_load=!0,b.comment_count(!1),window.onresize=function(a){b.set_width()},epoch_vars.live_mode&&Visibility.every(epoch_vars.epoch_options.interval,function(){0==b.shut_it_off&&b.comment_count(!0)}),a(document).on("click",".comment-reply-link",function(){b.parent_ID=a(this).parent().data("comment-id")}),a(document).on("submit","#"+epoch_vars.form_id,function(c){function d(c,d){if(1!=d){var e=document.getElementById("comment-"+d);null!=e&&("ASC"==epoch_vars.epoch_options.order?a(e).remove():a(e).parent().remove())}if(null==document.getElementById("comment-"+c.comment_ID)){html=b.parse_comment(c);var f=document.getElementById("comment-"+c.comment_ID);b.put_comment_in_dom(html,c.comment_parent,c.depth,id);var f=document.getElementById("comment-"+c.comment_ID);null!=f&&a(f).addClass("epoch-success").delay(100).queue(function(b){a(this).removeClass("epoch-success"),b()})}1==d&&(a(f).addClass("epoch-pending"),a(f).find(".epoch-comment-awaiting-moderation").remove(),a(f).find(".epoch-comment-link").remove()),jQuery("body").triggerHandler("epoch.comment.posted",[c.comment_post_ID,c.comment_ID]),"0"!=c.parent_approved&&($comment_parent=jQuery("#div-comment-"+c.parent_approved),$comment_parent.find(".epoch-approve").remove(),$comment_parent.removeClass("epoch-wrap-comment-awaiting-moderation")),b.parent_ID=0}c.preventDefault(),b.shut_it_off=!0,b.find_elements(),b.initial_load=!1;var e,f={},g=!1,h=[];if(a(b.form_el).find("select, textarea, input").each(function(){a(this).prop("required")&&(a(this).val()||(g=!0,h.push(a(this).attr("id"))))}),g)a(".epoch-failure").removeClass("epoch-failure"),0<h.length&&a.each(h,function(b,c){c=document.getElementById(c),null!==c&&a(c).parent().addClass("epoch-failure")});else{a(".epoch-failure").removeClass("epoch-failure"),a(b.form_el).addClass("epoch-submitting").find('input[type="submit"]').attr("disabled","disabled");var i=a(this).serializeArray(),j={};a.each(i,function(a,b){j[b.name]=b.value}),f.comment_parent=b.parent_ID,f.comment_content=j.comment;var k=f.comment_content.split("\n");f.comment_content=k.join("</p><p>"),f.comment_content="<p>"+f.comment_content+"</p>",""!=epoch_vars.user.comment_author?f.comment_author=epoch_vars.user.comment_author:j.hasOwnProperty("author")?f.comment_author=j.author:f.comment_author="",""!=epoch_vars.user.comment_author_url?f.comment_author_url=epoch_vars.user.comment_author_url:j.hasOwnProperty("url")?f.comment_author_url=j.url:f.comment_author_url="",""!=epoch_vars.user.author_avatar?f.author_avatar=epoch_vars.user.author_avatar:f.author_avatar=epoch_vars.empty_avatar,e=Math.floor(3991*Math.random())+10,f.comment_ID=e,d(f,!0),a.post(epoch_vars.submit_api_url,i).complete(function(){a(b.form_el).removeClass("epoch-submitting").find('input[type="submit"]').removeAttr("disabled")}).success(function(c){if(!c.success)return alert(epoch_translation.comment_rejected),!1;a("textarea#comment").val(""),a("#comment_parent").val("0"),temp_el=document.getElementById("wp-temp-form-div"),null!=temp_el&&(respond_el=document.getElementById("respond"),a(respond_el).insertAfter(temp_el)),b.set_last_count(parseInt(b.last_count)+1),c=b.get_data_from_response(c);var f=c.comment;id=parseInt(f.comment_ID,10),b.highest_id<id&&(b.highest_id=id),d(f,e),b.shut_it_off=!1}).fail(function(c){c.responseJSON&&c.responseJSON.data&&c.responseJSON.data.message&&alert(a("<div/>").html(c.responseJSON.data.message).text()),a(b.form_wrap_el,"textarea#comment").addClass("epoch-failure").delay(100).queue(function(b){a(this).removeClass("epoch-failure"),b()});var d=document.getElementById("comment-"+e);null!=d&&("ASC"==epoch_vars.epoch_options.order?a(d).remove():a(d).parent().remove())})}})},b.find_elements=function(){b.form_wrap_el=document.getElementById(epoch_vars.form_wrap),b.comments_wrap_el=document.getElementById(epoch_vars.comments_wrap),b.template_el=document.getElementById(epoch_vars.comments_template_id),b.count_el=document.getElementById(epoch_vars.count_id),b.form_el=document.getElementById(epoch_vars.form_id)},b.comments_open=function(){b.shut_it_off=!0,a.when(a.post(epoch_vars.api_url,{action:"comments_open",epochNonce:epoch_vars.nonce,postID:epoch_vars.post_id}).fail(function(a){b.shut_it_off=!1}).success(function(a){a=b.get_data_from_response(a),1==a?b.shut_it_off=!1:b.comments_closed=!0})).then(function(){var b=document.getElementById(epoch_vars.loading);a(b).fadeOut(350).attr("aria-hidden","true");var c=new Event("epoch_loaded");document.dispatchEvent(c)})},b.comment_count=function(a){!0===a&&(b.initial_load=!1),null!=epoch_vars.alt_comment_count?b.check_comment_count_from_file(a):b.comment_count_from_wp(a)},b.comment_count_from_wp=function(c){b.shut_it_off=!0,a.post(epoch_vars.api_url,{action:"comment_count",epochNonce:epoch_vars.nonce,postID:epoch_vars.post_id}).fail(function(a){b.shut_it_off=!1}).success(function(a){a=b.get_data_from_response(a),"undefined"!=a.count_total&&0<a.count_total?(c?a.count_approved>b.last_count&&b.new_comments():b.get_comments(),b.set_last_count(a.count_approved)):b.no_comments=!0,b.shut_it_off=!1})},b.check_comment_count_from_file=function(c){b.shut_it_off=!0,a.get(epoch_vars.alt_comment_count,{}).fail(function(){b.comment_count_from_wp(c)}).success(function(a){"undefined"!=a&&a>0?(c?a>b.last_count&&b.new_comments():b.get_comments(),b.set_last_count(a)):b.no_comments=!0,b.shut_it_off=!1})},b.get_comments=function(){b.shut_it_off=!0,a.post(epoch_vars.api_url,{action:"get_comments",epochNonce:epoch_vars.nonce,postID:epoch_vars.post_id,highest:0}).done(function(a){b.shut_it_off=!1}).success(function(a){a=b.get_data_from_response(a),b.comment_response(a,!1)})},b.comment_response=function(c,d){if("object"==typeof c&&"undefined"!=c&&"undefined"!=c.comments&&(comments=c.comments,comments=JSON.parse(comments),"undefined"!==comments&&0<comments.length)){var e=[],f=[];a.each(comments,function(a,c){id=parseInt(c.comment_ID,10),b.highest_id<id&&(b.highest_id=id),0==c.comment_parent?e.push(c):f.push(c)}),"ASC"==epoch_vars.epoch_options.order?(f.reverse(),e.reverse()):(e.reverse(),f.reverse()),a.each(e,function(c,e){html=b.parse_comment(e),b.put_comment_in_dom(html,e.comment_parent,e.depth,parseInt(e.comment_ID,10)),d&&(comment_el=document.getElementById("comment-"+e.comment_ID),null!=comment_el&&a(comment_el).addClass("epoch-success").delay(100).queue(function(b){a(this).removeClass("epoch-success"),b()}))}),a.each(f,function(a,c){html=b.parse_comment(c),b.put_comment_in_dom(html,c.comment_parent,c.depth,parseInt(c.comment_ID,10))}),d||(jQuery("body").triggerHandler("epoch.comments.loaded"),b.comment_scroll())}},b.new_comments=function(){b.shut_it_off=!0,a.post(epoch_vars.api_url,{action:"new_comments",epochNonce:epoch_vars.nonce,postID:epoch_vars.post_id,highest:b.highest_id}).done(function(a){b.shut_it_off=!1}).success(function(a){a=b.get_data_from_response(a),b.comment_response(a,!0)})},b.get_data_from_response=function(a){return a.data},b.parse_comment=function(c){return parent_id=c.comment_parent,source=a(b.template_el).html(),template=Handlebars.compile(source),html=template(c),html},b.put_comment_in_dom=function(c,d,e,f){if(e>b.max_depth&&(e=b.max_depth),0==d&&"DESC"==epoch_vars.epoch_options.order)first_child=b.comments_wrap_el.firstChild,new_el=document.createElement("div"),new_el.innerHTML=c,b.comments_wrap_el.insertBefore(new_el,first_child),!1===b.initial_load&&a(new_el).children().find("article").addClass("epoch-success").delay(750).queue(function(){a(this).removeClass("epoch-success")});else if(0==d?a(c).appendTo(b.comments_wrap_el):(c='<div class="epoch-child child-of-'+d+" level-"+e+' ">'+c+"</div>",parent_el=document.getElementById("comment-"+d),null!=parent_el?a(c).appendTo(parent_el):a(c).appendTo(b.comments_wrap_el)),!1===b.initial_load){var g=a(c).find("article").attr("id"),h=document.getElementById(g);a(h).addClass("epoch-success").delay(750).queue(function(){a(this).removeClass("epoch-success")})}a(".comment-reply-link").click(function(a){a.preventDefault()})},b.set_width=function(){el=document.getElementById(epoch_vars.sniffer),null!=el&&(content_width=a(el).parent().outerWidth(),"number"==typeof content_width&&(wrap_el=document.getElementById(epoch_vars.wrap_id),a(wrap_el).css("width",content_width)))},b.comment_scroll=function(){if(!(jQuery("iframe#epoch-comments").length>0)){var a=""+window.location,b=/(#comment-\d+)/;if(b.test(a)&&(a=jQuery(""+window.location.hash),a.length>0)){var c=a.offset().top;jQuery("html,body").animate({scrollTop:c},1)}}},b.set_last_count=function(c){b.last_count=c,a(b.count_el).text(c)},b.set_comment_status=function(c,d){return a.post(epoch_vars.api_url,{action:"moderate_comments",moderationAction:c,epochNonce:epoch_vars.nonce,postID:epoch_vars.post_id,highest:b.highest_id,commentID:d}).done(function(a){b.shut_it_off=!1}).success(function(a){return a=b.get_data_from_response(a),d=a.comment_id,status=a.status,$comment=jQuery("#div-comment-"+d),"spam"==status||"trash"==status?void $comment.fadeOut("slow"):(comment=Epoch.parse_comment(a.comment),void jQuery("#comment-"+d).replaceWith(comment))}),!1}}(jQuery,window.Epoch||(window.Epoch={}))}),jQuery(function(){Epoch.init()});